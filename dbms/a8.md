## Assignment 8
>
    Name : Ravish Ranjan
    Course : MCA
    Semester : 1st semester

### Creating DB and Tables

Creating the database

```sql
create database exp8;
```

Using the database

```sql
use exp8;
```

Creating table Employee

```sql
create table Employee (
    EmpID int primary key auto_increment,
    EmpName varchar(100) not null,
    Salary decimal(10, 2),
    Department varchar(50)
);
```

Creating table Employee\_Log (for question 2)

```sql
create table Employee_Log (
    LogID int primary key auto_increment,
    EmpID_Added int,
    LogMessage varchar(255),
    LogTimestamp timestamp default current_timestamp
);
```

Creating table Deleted\_Employees (for question 4)

```sql
create table Deleted_Employees (
    EmpID int,
    EmpName varchar(100),
    Salary decimal(10, 2),
    Department varchar(50),
    DeletionTimestamp timestamp default current_timestamp
);
```

### Questions

-----

1.  Create a BEFORE INSERT trigger to ensure that the salary of any new employee is not less than 3000. If it is, set it to 3000 automatically.

<!-- end list -->

```sql
delimiter $$
create trigger trg_before_insert_min_salary
before insert on Employee
for each row
begin
    -- Check if the new salary is less than 3000
    if new.Salary < 3000 then
        -- If it is, set it to 3000
        set new.Salary = 3000;
    end if;
end$$
delimiter ;
```

-----

2.  Create an AFTER INSERT trigger to log a message into a new table 'Employee\_Log' every time a new employee record is added.

<!-- end list -->

```sql
delimiter $$
create trigger trg_after_insert_log_employee
after insert on Employee
for each row
begin
    -- Insert a log message into the Employee_Log table
    insert into Employee_Log (EmpID_Added, LogMessage)
    values (new.EmpID, concat('New employee added: ', new.EmpName, ' (ID: ', new.EmpID, ')'));
end$$
delimiter ;
```


-----

3.  Write a BEFORE UPDATE trigger that prevents reducing an employeeâ€™s salary below the current salary.

<!-- end list -->

```sql
delimiter $$
create trigger trg_before_update_prevent_salary_decrease
before update on Employee
for each row
begin
    -- Check if the new salary is less than the old (current) salary
    if new.Salary < old.Salary then
        -- If it is, set the new salary back to the old salary
        -- Alternatively, signal an error to stop the update entirely:
        -- signal sqlstate '45000' set message_text = 'Error: Salary cannot be reduced.';
        set new.Salary = old.Salary;
    end if;
end$$
delimiter ;
```

-----

4.  Write an AFTER DELETE trigger that stores the details of deleted employees into a new table called 'Deleted\_Employees'.

<!-- end list -->

```sql
delimiter $$
create trigger trg_after_delete_archive_employee
after delete on Employee
for each row
begin
    -- Insert the details of the deleted employee into the archive table
    insert into Deleted_Employees (EmpID, EmpName, Salary, Department)
    values (old.EmpID, old.EmpName, old.Salary, old.Department);
end$$
delimiter ; 
```

### Inserting Sample Data
```sql
-- Inserting 5 sample employees
-- Note: The EmpID is AUTO_INCREMENT and will be set automatically.

insert into Employee (EmpName, Salary, Department)
values ('Alice Smith', 50000, 'Engineering'),
       ('Bob Johnson', 75000, 'Sales'),
       ('Charlie Brown', 2500, 'Marketing'),
       ('Diana Prince', 90000, 'Management'),
       ('Eve Polastri', 62000, 'Security');
```

### Employee Insertion Logs
```sql
select * from Employee_Log;
```

### Demonstrating update trigger
```sql
update Employee set Salary = 2700 where EmpName = "Chalie Johnson";
select * from Employee;
```

### Demonstrating delete trigger
```sql
select * from deleted_employees;
delete from EMployee where EmpName = "Charlie Johnson";
select * from deleted_emploees;
select * from Employee;
```
