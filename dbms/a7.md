## Assignment 7
### creating db and tables
`create database exp7;`


`use exp7;`


creating table Departments
>
    create table Departments(
        dept_id int not null primary key,
        dept_name varchar(20) not null
    );

creating table Employees
>
    create table Employees(
        emp_id int not null primary key,
        emp_name varchar(24) not null,
        age int not null,
        salary bigint not null,
        dept_id int not null,
        foreign key (dept_id) references Departments(dept_id)
    );

creating table Projects
>
    create table Projects(
        project_id int not null primary key,
        project_name varchar(24) not null
    );

creating table Employee_Projects
>
    create table Employee_Projects(
        emp_id int not null references Employees(emp_id),
        project_id int not null references Projects(project_id)
    );

inserting data in Departments table
>
    insert into Departments values
    (1,"HR"),
    (2,"Finance"),
    (3,"Engineering"),
    (4,"Marketing");

inserting data in Employees table
>
    insert into Employees values
    (1,"Alice",30,70000,3),
    (2,"Bob",28,60000,3),
    (3,"Charlie",32,80000,2),
    (4,"David",45,90000,1),
    (5,"Eve",35,75000,4),
    (6,"Frank",29,60000,2),
    (7,"Grace",38,85000,3);

inserting data in Projects table
>
    insert into Projects values
    (101,"Payroll System"),
    (102,"Recruitment Portal"),
    (103,"Ad Campaign"),
    (104,"Data Analytics");

inserting data in Employee_Projects table
>
    insert into Employee_Projects values
    (1,101),
    (1,104),
    (2,101),
    (3,101),
    (3,104),
    (4,102),
    (5,103),
    (6,104),
    (7,101),
    (7,102),
    (7,104);

### Questions
---
1. Retrieve details of the employee with the second highest salary.
>
    select *
    from Employees
    order by salary desc
    limit 1
    offset 1;
---
2. Find the department that has the maximum number of employees.
>
    select *
    from Departments
    where dept_id = (
        select dept_id
        from Employees
        group by dept_id
        order by count(*) desc
        limit 1
    );
---
3. List employees who work on all the projects on which Alice works on.
>
    select e.*
    from Employees e
    where not exists (
        select p1.project_id
        from Employee_projects p1
        join Employees e1
        on e1.emp_id = p1.emp_id
        and e1.emp_name = "Alice"
        except
        select p2.project_id
        from Employee_Projects p2
        where e.emp_id = p2.emp_id
    ) 
    and emp_name != "Alice";
---
4. Find the names of department whose employees works on an average on 2 or more projects.
>
    select d.*
    from Departments d
    join Employees e on e.dept_id = d.dept_id
    join Employee_Projects ep on e.emp_id = ep.emp_id
    group by e.dept_id
    having count(ep.project_id) / count(distinct e.emp_id) >= 2;
---
5. List employees whose salary is higher than the average salary of their department.
>
    select e.*
    from Employees e
    where e.salary > (
        select avg(salary)
        from Employees
        where dept_id = e.dept_id
    );
---